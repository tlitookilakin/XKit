{"id":"soft_refresh","script":"//* TITLE Soft Refresh **//\n//* VERSION 1.0.0 **//\n//* DESCRIPTION Refresh without refreshing **//\n//* DEVELOPER new-xkit **//\n//* DETAILS This extension allows you to see new posts on your dashboard without refreshing the page. When you get the New Posts bubble, click the home button, and new posts will appear on your dashboard.<br><br>Hold down the ALT key to perform a hard refresh using the home button. **//\n//* FRAME false **//\n//* BETA false **//\n//* SLOW true **//\n\nXKit.extensions.soft_refresh = new Object({\n\n\trunning: false,\n\tslow: true,\n\n\tloading: false,\n\ttop_post: {},\n\tpost_ids: [],\n\tdefault_page_title: document.title,\n\n\tpreferences: {\n\t\t\"use_logo\": {\n\t\t\ttext: \"Soft refresh when the tumblr logo is clicked\",\n\t\t\tdefault: false,\n\t\t\tvalue: false\n\t\t},\n\t\t\"use_home_button\": {\n\t\t\ttext: \"Soft refresh when the home button is clicked\",\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t},\n\t\t\"show_notifications\": {\n\t\t\ttext: \"Show refresh result notifications\",\n\t\t\tdefault: true,\n\t\t\tvalue: true\n\t\t}\n\t},\n\n\trun: function() {\n\t\tthis.running = true;\n\t\tXKit.tools.init_css(\"soft_refresh\");\n\n\t\tconst where = XKit.interface.where();\n\t\tconst paginated = location.pathname !== \"/dashboard\";\n\t\tif (where.dashboard === false || paginated === true) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.preferences.use_logo.value) {\n\t\t\t$(\".logo-anchor\")\n\t\t\t\t.attr(\"data-old-href\", $(\".logo-anchor\").attr(\"href\"))\n\t\t\t\t.css(\"cursor\", \"pointer\")\n\t\t\t\t.removeAttr(\"href\")\n\t\t\t\t.click(this.clicked);\n\t\t}\n\n\t\tif (this.preferences.use_home_button.value) {\n\t\t\t$(\"#home_button > a\")\n\t\t\t\t.attr(\"data-old-href\", $(\"#home_button > a\").attr(\"href\"))\n\t\t\t\t.removeAttr(\"href\")\n\t\t\t\t.click(this.clicked);\n\t\t}\n\t},\n\n\tclicked: function(event) {\n\t\tif (event.altKey) {\n\t\t\tlocation.reload(true);\n\t\t} else {\n\t\t\tXKit.extensions.soft_refresh.start_load();\n\t\t}\n\t},\n\n\tstart_load: function() {\n\t\tif (this.loading) { return; }\n\t\tthis.loading = true;\n\n\t\t$(\"html, body\").animate({scrollTop: 0}, \"slow\");\n\n\t\t$(\"#new_post\").after('<div id=\"xkit_soft_refresh\">Checking for new posts</div>');\n\t\t$(\"#xkit_soft_refresh\").slideDown(\"fast\");\n\n\t\t$(\"#new_post_notice_container\").css({\n\t\t\ttransform: \"scale(0)\",\n\t\t\topacity: 0\n\t\t});\n\n\t\tthis.top_post = $(\"#posts > li.post_container:not(#new_post_buttons)\").first();\n\t\tthis.request();\n\t},\n\n\trequest: function(after_post_id) {\n\t\tfetch(\"https://www.tumblr.com/dashboard\" + (after_post_id ? `/2/${after_post_id}` : \"\")).then(response => {\n\t\t\tif (!response.ok) {\n\t\t\t\tthis.show_error();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresponse.text().then(responseText => {\n\t\t\t\tif (!after_post_id) {\n\t\t\t\t\t$(\"#new_post_notice_container .tab_notice_value\").html(\"0\");\n\t\t\t\t\tdocument.title = this.default_page_title;\n\t\t\t\t\t$(\"#new_post_notice_container\")\n\t\t\t\t\t\t.removeClass(\"tab-notice--active\")\n\t\t\t\t\t\t.removeAttr(\"style\");\n\t\t\t\t\t$(\"#posts > li.notification:not(.post_container:not(#new_post_buttons) ~ .notification)\").remove();\n\t\t\t\t}\n\n\t\t\t\tlet end = false;\n\n\t\t\t\t$(\"#posts > li\", responseText)\n\t\t\t\t\t.not(\"#new_post_buttons\")\n\t\t\t\t\t.not(\".standalone-ad-container\")\n\t\t\t\t\t.not(\":has([data-sponsored], [data-is_recommended])\")\n\t\t\t\t\t.each(function() {\n\t\t\t\t\t\tconst $this = $(this);\n\n\t\t\t\t\t\tif ($this.attr(\"data-pageable\") !== undefined) {\n\t\t\t\t\t\t\tif ($(`[data-pageable=\"${$this.attr(\"data-pageable\")}\"]`).length) {\n\t\t\t\t\t\t\t\tend = true;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tXKit.extensions.soft_refresh.post_ids.unshift($this.attr(\"data-pageable\").replace(\"post_\", \"\"));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tXKit.extensions.soft_refresh.top_post.before($this);\n\t\t\t\t\t});\n\n\t\t\t\tif (!end) {\n\t\t\t\t\tthis.request(this.post_ids[0]);\n\t\t\t\t} else {\n\t\t\t\t\tif (this.post_ids.length === 0) {\n\t\t\t\t\t\tif (this.preferences.show_notifications.value) {\n\t\t\t\t\t\t\tXKit.notifications.add(\"No new posts found.\", \"info\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tXKit.tools.add_function(this.trigger_tumblr_events, true);\n\t\t\t\t\t\tif (this.preferences.show_notifications.value) {\n\t\t\t\t\t\t\tXKit.notifications.add(`Added ${this.post_ids.length} new ${(this.post_ids.length === 1 ? \"post\" : \"posts\")}.`, \"ok\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$(\"#xkit_soft_refresh\").slideUp(\"fast\", function() { $(this).remove(); });\n\t\t\t\t\tthis.post_ids = [];\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t}\n\t\t\t});\n\t\t}).catch(() => this.show_error());\n\t},\n\n\ttrigger_tumblr_events: function() {\n\t\tTumblr.Events.trigger(\"posts:load\");\n\t\tTumblr.Events.trigger(\"DOMEventor:updateRect\");\n\t},\n\n\tshow_error: function() {\n\t\t$(\"#new_post_notice_container\").removeAttr(\"style\");\n\t\t$(\"#xkit_soft_refresh\").slideUp(\"fast\", function() { $(this).remove(); });\n\t\tthis.post_ids = [];\n\t\tthis.loading = false;\n\n\t\tXKit.window.show(\n\t\t\t\"Can't get new posts\",\n\n\t\t\t\"I could not fetch the page requested.<br>\" +\n\t\t\t\"There might be a problem with Tumblr servers, please try again later or try refreshing manually.\",\n\n\t\t\t\"error\",\n\n\t\t\t'<div id=\"xkit-close-message\" class=\"xkit-button default\">OK</div>' +\n\t\t\t'<div id=\"xkit-refresh-page\" class=\"xkit-button\">Refresh the page</div>'\n\t\t);\n\t\t$(\"#xkit-refresh-page\").click(() => location.reload(true));\n\t},\n\n\tdestroy: function() {\n\t\t$(\".logo-anchor\")\n\t\t\t.attr(\"href\", $(\".logo-anchor\").attr(\"data-old-href\"))\n\t\t\t.removeAttr(\"style\")\n\t\t\t.off(\"click\");\n\n\t\t$(\"#home_button > a\")\n\t\t\t.attr('href', $(\"#home_button > a\").attr('data-old-href'))\n\t\t\t.off(\"click\");\n\n\t\tXKit.tools.remove_css(\"soft_refresh\");\n\t\tthis.running = false;\n\t}\n\n});\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,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\n","css":"#xkit_soft_refresh {\n\tbackground: rgba(0,0,0,0.10);\n\tborder-radius: 3px;\n\tcolor: rgba(255,255,255,0.64);\n\tpadding: 0px 20px;\n\tfont-family: \"Helvetica Neue\", sans-serif;\n\tfont-size: 13px;\n\theight: 40px;\n\ttext-align: center;\n\tdisplay: none;\n\tmargin-top: 20px;\n\tline-height: 40px;\n}\n","title":"Soft Refresh","description":"Refresh without refreshing","developer":"new-xkit","version":"1.0.0","details":"This extension allows you to see new posts on your dashboard without refreshing the page. When you get the New Posts bubble, click the home button, and new posts will appear on your dashboard.<br><br>Hold down the ALT key to perform a hard refresh using the home button.","frame":"false","beta":"false","slow":"true"}